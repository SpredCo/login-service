api:
  name: Spred Login service
  description: |
    The login service of the Spred api allows clients to create user, and retreive **access token** needed to get resources from the api.;;;
    The *OAuth2 Authorization Framework* as been implemented.
    For more information, check the {{RFC 6749!https://tools.ietf.org/html/rfc6749}}.;;;
    The login is available here : {{login.sharemyscreen.fr:3000!http://login.sharemyscreen.fr:3000}};;;
    The **api** service documentation will be available here {{api.sharemyscreen.fr:3000/doc!http://api.sharemyscreen.fr:3000/doc}}
  paragraphs:
    -
      Information:
        text: |
          The login service of the Spred api allows registred clients to create user, and retreive **access token**.;;;
          As explained in the {{RFC 6749!https://tools.ietf.org/html/rfc6749}}, obtain an access token is needed to get resources from the api.;;;
    -
      Basic Authentication:
        text: |
          All requests sent to the login service MUST be authenticated by *Basic Authentication*. Here is the {{RFC!https://tools.ietf.org/html/rfc2617}};;;
          Basically, you will need include in the **HTTP Header** of the request :;;;
          ```
          Authorization: Basic <CLIENT HASH>
          ```
          The *<CLIENT HASH>* field is the encoding in **base 64** of your `<client_key>:<client_secret>`.;;;
          If you don't have created a client yet, check the {{developer server documentation!http://dev.sharemyscreen.fr:3000/doc}} to create one.;;;
          ;;;
          If a request is unauthenticated, the server will reply a status code **403** with a body **Unauthorized**.
    -
      Tokens:
        text: |
          The login service will reply with an {{access object!object-access}}.;;;
          The **access_token** will allow you to request the api, save it. But it have an expiration date, after it, the token won't work anymore and will have to {{refresh it!routes-v1-oauth2-token-post}}.;;;
          The **refresh_token** will allow you to refresh your **access_token**.;;;
          The **creation** field tells if the user was created or not.
    -
      Request and Reply format:
        text: |
          All requests must be **HTTP** request.;;;
          Request body must be **JSON** formated.;;;
          Reply are **JSON** formated object in **snake_case**.
  tags:
    -
      Basic Auth:
        link: paragraph-basic-authentication

  routes:
    -
      /v1/users:
        post:
          summary: Create a new user
          tags:
            - Basic Auth
          parameters:
            -
              email:
                description: User email
                in: body
                type: string
                required: true
            -
              password:
                description: User password
                in: body
                type: string
                required: true
            -
              first_name:
                description: User first name
                in: body
                type: string
                required: true
            -
              last_name:
                description: User last name
                in: body
                type: string
                required: true
          responses:
            -
              201:
                description: User created
                type: User
          errors:
            - Invalid request
            - User exists

  errors:
    -
      Invalid request:
        status: 400
        code: 1
        message: Invalid request
        fix: Check the request parameters twice
    -
      User exists:
        status: 403
        code: 2
        subcode: 1
        message: User exists (email address already in use)

  objects:
    -
      Error:
        description: Error object (sub_code is facultative)
        obj:
          code: 0
          sub_code: 0
          message: ""
    -
      Short Error:
        description: Error object (Generated by OAuth2 plugin)
        obj:
          error: ""
          error_description: ""
    -
      User:
        description: User object
        obj:
          id: ""
          email: ""
          first_name: ""
          last_name: ""
          picture_url: ""